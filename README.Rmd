---
title: "The 'ratioOfQsprays' package"
author: "St√©phane Laurent"
date: "`r Sys.Date()`"
output: github_document
---

*Fractions of multivariate polynomials with rational coefficients.*

<!-- badges: start -->
[![R-CMD-check](https://github.com/stla/ratioOfQsprays/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/stla/ratioOfQsprays/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

___

The **qspray** package allows arithmetic (and more) on multivariate polynomials 
with rational coefficients. Based on this one, the **ratioOfQsprays** package 
allows to manipulate fractions of multivariate polynomials with rational 
coefficients.


## Creating a `ratioOfQsprays` 

A `ratioOfQsprays` object represents a fraction of two multivariate 
polynomial with rational coefficients. Such polynomials are represented by 
`qspray` objects. The easiest way to create a `ratioOfQsprays` is to introduce 
the variables of the polynomials with the `qlone` function (from the **qspray** 
package), and then to build a `qspray` numerator and a `qspray` denominator 
with the arithmetic operations. 
For example:

```{r, message=FALSE, collapse=TRUE}
library(ratioOfQsprays)
f <- function(x1, x2, x3) {
  (2*x1^2 + x2*x3) / (4*x1 - 3*x3 + 1)
}
# variables:
x1 <- qlone(1)
x2 <- qlone(2)
x3 <- qlone(3)
# the 'ratioOfQsprays':
( roq <- f(x1, x2, x3) )
```

Arithmetic on `ratioOfQsprays` objects is available:

```{r, message=FALSE, collapse=TRUE}
roq^2
roq - roq
1 / roq
2*roq + (x2 + x3)/x1
```

Rational numbers and `qspray` polynomials are coercable to 
`ratioOfQsprays` objects, and then you can also perform arithmetic operations 
between a `ratioOfQsprays` and such an object:

```{r, message=FALSE, collapse=TRUE}
2 * roq
"1/2" * roq
roq + gmp::as.bigq("7/3") 
x1 + roq + x3^2
```

The result of an arithmetic operation is always an irreducible fraction. 
To perform this step, the C++ library **CGAL** is used to compute a greatest 
common divisor of the numerator and the denominator of the possibly non-reduced 
fraction resulting from the arithmetic operation, and then to divide both of 
them by this greatest common divisor. This is very efficient in general.


## Evaluating a `ratioOfQsprays` 

Use `evalRatioOfQsprays` to evaluate a `ratioOfQsprays`. This function returns 
a `bigq` number:

```{r, message=FALSE, collapse=TRUE}
library(gmp) # rational numbers
x <- c("4", "3", "2/5")
evalRatioOfQsprays(roq, x)
x <- as.bigq(x)
evalRatioOfQsprays(roq, x)
f(x[1], x[2], x[3])
```


## Querying a `ratioOfQsprays` 

A couple of functions to query a `ratioOfQsprays` are available:

```{r, collapse=TRUE}
getNumerator(roq)
getDenominator(roq)
numberOfVariables(roq)
isConstant(roq)
isConstant(roq / roq)
isUnivariate(roq)
isUnivariate(x1 / (x1^2 + 1))
isPolynomial(roq)
isPolynomial((x1^2 - x2^2)/(x1 - x2))
```


## Showing a `ratioOfQsprays` 

As you have seen, the variables of `roq` are denoted by `x`, `y`, `z`. This is 
the default of showing a `ratioOfQsprays` which have no more than three 
variables. If it has more than three variables, the variables are denoted by 
`x1`, `x2`, `x3`, ...:

```{r, collapse=TRUE}
x4 <- qlone(4)
roq / x4
```

It is possible to control the way a `ratioOfQsprays` is printed. For example, 
let's say you want to print `roq` by using `a1`, `a2`, `a3` for the variables 
and you want to change the symbol for the quotient:

```{r, collapse=TRUE}
showRatioOfQspraysOption(roq, "x") <- "a"
showRatioOfQspraysOption(roq, "quotientBar") <- " / " 
roq
```

Now, if you perform an arithmetic operation between `roq` *at first position* 
and an another `ratioOfQsprays` or an object coercable to a `ratioOfQsprays`, 
these show options are passed to the result if possible:

```{r, collapse=TRUE}
roq + (x1 + 1)/x2
```

Here it is always possible to pass the options to the result. An obvious 
example for which this is not always possible is when you use three letters 
for the variables, e.g.

```{r, collapse=TRUE}
showRatioOfQspraysOption(roq, "showQspray") <- showQsprayXYZ(c("A", "B", "C"))
roq
```

but then you add a `ratioOfQsprays` containing the fourth variable:

```{r, collapse=TRUE}
roq + x4/(x4 + 1)
```

Obviously it is not possible to denote the resulting fraction of polynomials 
with the letters `A`, `B` and `C`. The solution I adopted consists in 
taking the first of these letters and to index it. The same method is used 
for the `qspray` polynomials.
